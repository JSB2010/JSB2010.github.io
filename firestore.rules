rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow CORS for specific domains
    match /{document=**} {
      allow read, write: if request.auth != null ||
                          request.origin == 'https://modern-redesign-shadcn.jsb2010-github-io.pages.dev' ||
                          request.origin == 'https://jacobbarkin.com' ||
                          request.origin == 'https://www.jacobbarkin.com';
    }

    // Contact form submissions - allow anonymous creation and reading
    match /contactSubmissions/{submission} {
      // Allow anyone to create contact submissions with no restrictions
      allow create: if true;

      // Allow reading for testing purposes
      allow read: if true;

      // No one can update or delete submissions
      allow update, delete: if false;
    }

    // Project views - allow reading, only allow creation/updating through functions
    match /projectViews/{projectId} {
      allow read: if true;
      allow create, update, delete: if false;
    }

    // Project feedback - only allow creation, no reading/updating/deleting
    match /projectFeedback/{feedback} {
      allow create: if true;
      allow read, update, delete: if false;
    }

    // User preferences - allow users to read/write their own preferences
    match /userPreferences/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
